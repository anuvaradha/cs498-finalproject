<!DOCTYPE html>
<meta charset="utf-8">
<style>

.bar {
  fill: steelblue;
}

.bar:hover {
  fill: brown;
}

.axis--x path {
  display: none;
}
  
* {box-sizing: border-box}
body {font-family: Verdana, sans-serif; margin:0}
.mySlides {display: none}
img {vertical-align: middle;}

/* Slideshow container */
.slideshow-container {
  max-width: 1000px;
  position: relative;
  margin: auto;
}

/* Next & previous buttons */
.prev, .next {
  cursor: pointer;
  position: absolute;
  top: 50%;
  width: auto;
  padding: 16px;
  margin-top: -22px;
  color: #337ab7;
  font-weight: bold;
  font-size: 18px;
  transition: 0.6s ease;
  border-radius: 0 3px 3px 0;
}
  
.prev {
  left: -30px
  }

/* Position the "next button" to the right */
.next {
  right: 0;
  border-radius: 3px 0 0 3px;
}

/* On hover, add a black background color with a little bit see-through */
.prev:hover, .next:hover {
  background-color: rgba(0,0,0,0.8);
}

/* Caption text */
.text {
  color: #f2f2f2;
  font-size: 15px;
  padding: 8px 12px;
  position: absolute;
  bottom: 8px;
  width: 100%;
  text-align: center;
}

/* Number text (1/3 etc) */
.numbertext {
  color: #f2f2f2;
  font-size: 12px;
  padding: 8px 12px;
  position: absolute;
  top: 0;
}

/* The dots/bullets/indicators */
.dot {
  cursor: pointer;
  height: 15px;
  width: 15px;
  margin: 0 2px;
  background-color: #bbb;
  border-radius: 50%;
  display: inline-block;
  transition: background-color 0.6s ease;
}

.active, .dot:hover {
  background-color: #717171;
}

/* Fading animation */
.fade {
  -webkit-animation-name: fade;
  -webkit-animation-duration: 1.5s;
  animation-name: fade;
  animation-duration: 1.5s;
}

@-webkit-keyframes fade {
  from {opacity: .4} 
  to {opacity: 1}
}

@keyframes fade {
  from {opacity: .4} 
  to {opacity: 1}
}

/* On smaller screens, decrease text size */
@media only screen and (max-width: 300px) {
  .prev, .next,.text {font-size: 11px}
}
  .tooltip {
    opacity: 0;
    position: absolute;
    text-align: center;
    width: 60px; height: 40px;
    background: white;
    border: 0px;
}
  
  rect.bordered {
        stroke: #E6E6E6;
        stroke-width:2px;   
      }

      text.mono {
        font-size: 9pt;
        font-family: Consolas, courier;
        fill: #aaa;
      }

      text.axis-workweek {
        fill: #000;
      }

      text.axis-worktime {
        fill: #000;
      }
  
  text.label {
  fill:white;
  font: 15px;  
  font-weight: 400;
  text-anchor: middle;
}

</style>

<html lang="en">
<head>
  <title>Anusha CS 498 Final project</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src = "https://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
</head>
<body>

<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="#">Ford Go Bike Analysis</a>
    </div>
    <ul class="nav navbar-nav">
    </ul>
    <ul class="nav navbar-nav navbar-right">
      <button type="button" class="btn btn-primary navbar-btn" data-toggle="modal" data-target="#myModal">
            <span class="glyphicon"></span> 
            About this visualization
          </button>
    </ul>
  </div>
</nav>
  
<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">About this Visualization</h4>
      </div>
      <div class="modal-body">
        <p>This visualization follows an interactive slideshow narrative visualization structure because I have specified the path that the user should take (author-led) and then the user is able to investigate details on each chart but must proceed on the defined path.</p>
        <h4>Scenes </h4>
        <p>There are a total of 4 scenes. The first scene is an introduction to the whole presentation and the last scene is a conclusion. The 2nd and 3rd scene contain charts. Each scene has a previous and next button and at the bottom, there are dots to allow the user to jump to any of the scenes they want. The 2nd scene is a bar graph with axes and titles. Bar graph was an appropriate choice to depict which day of the month had the most riders. The third scene is a heat map with the names of the days as the y axis and hours as the x axis. There is also a scale showing what each color represents. There are also buttons below the chart to allow the user to filter the data. A heat map was chosen so that the user could compare the most popular times across multiple days.</p>
        <h4>Annotations </h4> 
        <p>On the second scene, I have added text annotations on the bars to indicate whether they were a holiday or a sunday. This is useful for the user to see the trend of the number of rides whether it was a holiday or not. The inclusion of the text Sunday was to help demarcate when one week started/ended. This annotation is cleared when we move to the third scene because the axis has the text Sunday and we are more of focussing on the trends of which are the most popular hours rather than days.</p>
        <h4>Parameters </h4>
        <p>Each scene corresponds to a slide number and when the slide number is changed, it triggers a change in the display. On the 2nd scene, the parameters are the colors of the bar and the flag whether to show or hide the text that is shown at the bottom when hovered over a bar. On the 3rd scene, the parameters are the buttons at the bottom of the scene to determine which week of the data is to be displayed.</p>
        <h4>Triggers </h4>
        <p>The left and right arrows and the dots at the bottom are triggers in the sense that they control which scene to display. In the 2nd scene, when the selected bar is hovered over, it turns brown and also displays information about the bar at the bottom of the chart. In the 3rd scene, the buttons below the chart change the values in the heatmap and the scale (what range of values corresponds to what color). Also, a hover over each square displays the count of the rides.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>
 
<div class="slideshow-container">
  
<div class="mySlides">
      <h3>Introduction</h3>
      <p>The following visualizations are presenting information about the ridership of Ford Go Bike, a bikesharing company operating in the Bay Area.</p>
      <p>I utilized the dataset from <a href =>https://www.fordgobike.com/system-data</a></p>
      <p>For the purpose of this project, I have focussed on the number of trips made in the month of January.</p> 
      <p>Over the next few slides, we will explore how the ridership varies across the days of the month and when are the most popular times to ride a GoBike. </p>
      <p>Click the left arrow to go to the conclusion or click on the right arrow to proceed to the next slide. </p>
</div>

<div class="mySlides">
      <h3>Popular days in January to ride a GoBike</h3>
      <p>The below chart depicts the number of trips per day in the month of January. </p>
      <p>The x axis is the day of the month and the y axis is the number of trips. </p>
      <p>You can hover over each bar to get more details about the number of trips made that day. </p>
      <p>Click the left arrow to go back to the introduction or click on the right arrow to proceed to the next slide. </p>
      <svg width="960" height="500"></svg>
      <div id="tooltip"></div>
</div>

<div class="mySlides">
  <h3>Popular times to ride a GoBike during the week</h3>
  <p>The below chart depicts the number of trips per hour per day of the week in January. </p>
  <p>The x axis is the hour and the y axis is the day of the week. Each rectangle represents the number of rides which is colored as per the scale. </p>
  <p> To begin your analysis, select an option from the buttons below the chart. 
  <p>You can hover over each rectangle to get number of trips made. </p>
  <p>Change the selection using the buttons below. </p>
  <p>Click the left arrow to go back to the first visualization or click on the right arrow to proceed to the next slide. </p>
  <div id="chart"></div>
  <div id="dataset-picker"></div>
</div>

<div class="mySlides">
  <h3>Conclusion</h3>
  <p>From the two charts provided, we can see that ridership is higher on the week days versus holidays and weekend. </p>
  <p>Also, the most popular times are generally between 8am to 10 am and 5pm to 7pm which coincides with peak traffic times. </p>
  <p>For more information regarding the visualization, please click on the button "About this Visualization"</p> 
  <p>For the code, please visit <a href=>https://github.com/anuvaradha/cs498-finalproject<a></p>
  <p>Sources: </p>
  <ul>
  <li><a href="https://bl.ocks.org/mbostock/3885304">Bar Chart sample</a></li>
  <li><a href="http://bl.ocks.org/tjdecke/5558084">Heat Map sample</a></li>
  <li><a href="https://www.w3schools.com/howto/howto_js_slideshow.asp">Slideshow </a></li>
  </ul>
</div>

<a class="prev" onclick="plusSlides(-1)">&#10094;</a>
<a class="next" onclick="plusSlides(1)">&#10095;</a>

</div>
<br>

<div style="text-align:center">
  <span class="dot" onclick="currentSlide(1)"></span> 
  <span class="dot" onclick="currentSlide(2)"></span> 
  <span class="dot" onclick="currentSlide(3)"></span> 
  <span class="dot" onclick="currentSlide(4)"></span> 
</div>
  
  <script>
var slideIndex = 1;
showSlides(slideIndex);

function plusSlides(n) {
  showSlides(slideIndex += n);
}

function currentSlide(n) {
  showSlides(slideIndex = n);
}

function showSlides(n) {
  var i;
  var slides = document.getElementsByClassName("mySlides");
  var dots = document.getElementsByClassName("dot");
  if (n > slides.length) {slideIndex = 1}    
  if (n < 1) {slideIndex = slides.length}
  for (i = 0; i < slides.length; i++) {
      slides[i].style.display = "none";  
  }
  for (i = 0; i < dots.length; i++) {
      dots[i].className = dots[i].className.replace(" active", "");
  }
  slides[slideIndex-1].style.display = "block";  
  dots[slideIndex-1].className += " active";
}
</script>
  
   <script>
     
    var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;
   
    var svg = d3.select("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom);
    
    var g = svg.append("g")
    .attr("transform", 
          "translate(" + margin.left + "," + margin.top + ")");

      var x = d3.scaleBand().range([0, width]).padding(0.1),
          y = d3.scaleLinear().range([height, 0]);
     
     d3.csv("Chart1_data.csv", function(d) {
        d.Frequency = +d.Frequency;
        return d;
      }, function(error, data) {
        if (error) throw error;

        x.domain(data.map(function(d) { return d.Day; }));
        y.domain([0, d3.max(data, function(d) { return d.Frequency; })]);
       
        var tooltip = d3.select("#tooltip");

        g.selectAll(".bar")
          .data(data)
          .enter().append("rect")
            .attr("class", "bar")
            .attr("x", function(d) { return x(d.Day); })
            .attr("y", function(d) { return y(d.Frequency); })
            .attr("width", x.bandwidth())
            .attr("height", function(d) { return height - y(d.Frequency); })
            .on("mouseover", function(d,i) {
                tooltip.style("opacity", 1)
               .style("left", (d)+"px")
               .style("top",(d)+"px")
               .html("Date: January "+d.Day+" 2018 <br/>  Number of records: "+d.Frequency);
            })
          .on("mouseout", function() { tooltip.style("opacity", 0) });
       
        g.selectAll(".text")  		
          .data(data)
          .enter()
          .append("text")
          .attr("class","label")
          .attr("transform", "rotate(-90)")
          .attr("x", function(d) {
                if(d.Day == 1)
                   return -400;
                if(d.Day == 7 || d.Day == 14 || d.Day == 21 || d.Day == 28)
                   return -400;
                if(d.Day == 15)
                  return -350;
                return 0;
            })
          .attr("y", function(d) {
                if(d.Day == 1)
                   return 10;
                if(d.Day == 7)
                   return 185;
                if(d.Day == 14)
                    return 387;
                if(d.Day == 15)
                  return 418;
                if(d.Day == 21)
                  return 590;
                if(d.Day == 28)
                   return 795;
                return 0;
            })
          .attr("dy", ".75em")
          .text(function(d) { 
               if(d.Day == 1) 
                  return  "New Years Day";
                if(d.Day == 7 || d.Day == 14 || d.Day == 21 || d.Day == 28)
                  return "Sunday";
               if(d.Day == 15) 
                  return  "Martin Luther King Jr. Day";
                return "";
            }); 
       
         svg.append("g")
        .attr("transform", "translate(" + margin.left + "," + (height+margin.top) + ")")
        .call(d3.axisBottom(x));
       
       svg.append("text")             
        .attr("transform",
            "translate(" + (472) + " ," + 
                           (497) + ")")
        .style("text-anchor", "middle")
        .text("Start Time (Day)");

        // add the y Axis
        svg.append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
          .call(d3.axisLeft(y));
       
       svg.append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", -4)
      .attr("x",-240)
      .attr("dy", "1em")
      .style("text-anchor", "middle")
      .text("Number of records"); 
});
           
   </script>
  
   <script type="text/javascript">
      var margin2 = { top: 50, right: 0, bottom: 100, left: 30 },
          width2 = 960 - margin.left - margin.right,
          height2 = 430 - margin.top - margin.bottom,
          gridSize = Math.floor(width2 / 24),
          legendElementWidth = gridSize*2,
          buckets = 9,
          colors = ["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"], // alternatively colorbrewer.YlGnBu[9]
          days = ["Mo", "Tu", "We", "Th", "Fr", "Sa", "Su"],
          times = ["1a", "2a", "3a", "4a", "5a", "6a", "7a", "8a", "9a", "10a", "11a", "12p", "1p", "2p", "3p", "4p", "5p", "6p", "7p", "8p", "9p", "10p", "11p", "12a"];
          var datasets = ["Chart2_data.csv", "Week1_data.csv", "Week2_data.csv", "Week3_data.csv", "Week4_data.csv"];

      var chart2 = d3.select("#chart").append("svg")
          .attr("width", width2 + margin2.left + margin2.right)
          .attr("height", height2 + margin2.top + margin2.bottom)
          .append("g")
          .attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");

      var dayLabels = chart2.selectAll(".dayLabel")
          .data(days)
          .enter().append("text")
            .text(function (d) { return d; })
            .attr("x", 0)
            .attr("y", function (d, i) { return i * gridSize; })
            .style("text-anchor", "end")
            .attr("transform", "translate(-6," + gridSize / 1.5 + ")")
            .attr("class", function (d, i) { return ((i >= 0 && i <= 4) ? "dayLabel mono axis axis-workweek" : "dayLabel mono axis"); });

      var timeLabels = chart2.selectAll(".timeLabel")
          .data(times)
          .enter().append("text")
            .text(function(d) { return d; })
            .attr("x", function(d, i) { return i * gridSize; })
            .attr("y", 0)
            .style("text-anchor", "middle")
            .attr("transform", "translate(" + gridSize / 2 + ", -6)")
            .attr("class", function(d, i) { return ((i >= 7 && i <= 16) ? "timeLabel mono axis axis-worktime" : "timeLabel mono axis"); });

      var heatmapChart = function(csvFile) {
        d3.csv(csvFile,
        function(d) {
          return {
            day: +d.Day,
            hour: +d.Hour,
            value: +d.Value
          };
        },
        function(error, data) {
          var colorScale = d3.scaleQuantile()
              .domain([0, buckets - 1, d3.max(data, function (d) { return d.value; })])
              .range(colors);

          var cards = chart2.selectAll(".hour")
              .data(data, function(d) {return d.day+':'+d.hour;});

          cards.append("title");

          cards.enter().append("rect")
              .attr("x", function(d) { return (d.hour) * gridSize; })
              .attr("y", function(d) { return (d.day - 1) * gridSize; })
              .attr("rx", 4)
              .attr("ry", 4)
              .attr("class", "hour bordered")
              .attr("width", gridSize)
              .attr("height", gridSize)
              .style("fill", colors[0]);

          cards.transition().duration(1000)
              .style("fill", function(d) { return colorScale(d.value); });

          cards.select("title").text(function(d) { return d.value; });
          
          cards.exit().remove();

          var legend = chart2.selectAll(".legend")
              .data([0].concat(colorScale.quantiles()), function(d) { return d; });

          legend.enter().append("g")
              .attr("class", "legend");

          legend.append("rect")
            .attr("x", function(d, i) { return legendElementWidth * i; })
            .attr("y", height2)
            .attr("width", legendElementWidth)
            .attr("height", gridSize / 2)
            .style("fill", function(d, i) { return colors[i]; });

          legend.append("text")
            .attr("class", "mono")
            .text(function(d) { return "â‰¥ " + Math.round(d); })
            .attr("x", function(d, i) { return legendElementWidth * i; })
            .attr("y", height2 + gridSize);

          legend.exit().remove();

        });  
      };

      heatmapChart(datasets[0]);
      
      var datasetpicker = d3.select("#dataset-picker").selectAll(".dataset-button")
        .data(datasets);

      datasetpicker.enter()
        .append("input")
        .attr("value", function(d, i){ 
            var names = ["All weeks", "Week 1", "Week 2", "Week 3", "Week 4"];
            return names[i];
          })
        .attr("type", "button")
        .attr("class", "dataset-button")
        .on("click", function(d) {
          heatmapChart(d);
        });
    </script>

</body>
</html>
